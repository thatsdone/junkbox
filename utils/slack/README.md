# slackutl.py - A Tiny Slack Message Handling Utility

## Overivew

slackutl.py is a tiny utility for slack messages handling automation.

It supports the following commands that roughly correspond to slack API
methods.

Basically, this utility assumes operations to a single channel. Note that
it means also DM to a particular user including yourself and
DM groups with several users.

* history - Dump history of conversation of a slack channel
    * https://api.slack.com/methods/conversations.history
* write - Post a message to a slack channel
    * https://api.slack.com/methods/chat.postMessage
* delete - Delete a message from a slack channel
    * https://api.slack.com/methods/chat.delete
* generic - Command for generic API usage taking an API endpoint

## Files

* README.md
    * This file.
* slackutil.py
    * The main utility.
* slack-log-reader.py
    * A simple log viewer to see output files of history operation of
     `slackutl.py -o`
* slackutl.yaml
    * Example configuration file. You need to specify API token and Channel ID.
* cleanup.sh
    * A simple script to delete all the messages recorded in a JSON file
    generated by 'history' command of slackutl.py
* worker.sh
    * A wrapper script to save and delete all the messages in a channel.
    This script calls 'cleanup.sh' above recursively until all the messages
    are saved and deleted.


## Preparation

### Create

### Check Channel ID

Regarding the Channel ID to work with, you can see from
"Open conversation details > About".

### Create a Slack app

Create a slack app and associate it to your slack site and channel.

https://api.slack.com/apps

### Get an API token

Here, I use 'User tokens' of Slack API.

https://api.slack.com/concepts/token-types#user

Go to "OAuth & Permissions" section of your app screen to create your token.
You can see your 'User OAuth Token' there.

### Create slackutl.py configuration file

Although you can specify Channel ID and User OAuth Token from command line,
it's also convenient to write it to a configuration file.

```
$ cat slackutl.yaml
# your slack API token
token: 'YOUR_TOKEN'
# default channel
channel: 'YOUR_CHANNEL'
```

Repplace 'YOUR TOKEN' by your User OAuth Token and 'YOUR CHANNEL' by
Channel ID you prepared above.

## Usage

### Command line parameters

```
$ python3 slackutl.py  -h
usage: slackutl.py [-h] [-c CONFIG] [-u URL] [-C CHANNEL] [-T TOKEN]
                   [-t TIMESTAMP] [-o OPERATION] [-m MESSAGE] [-k KEYVALUES]

slackutl.py

options:
  -h, --help            show this help message and exit
  -c CONFIG, --config CONFIG
  -u URL, --url URL
  -C CHANNEL, --channel CHANNEL
  -T TOKEN, --token TOKEN
  -t TIMESTAMP, --timestamp TIMESTAMP
  -o OPERATION, --operation OPERATION
  -m MESSAGE, --message MESSAGE
  -k KEYVALUES, --keyvalues KEYVALUES
```

### Use Case 1 : Post a message

Just post a message to a channel.

```
$ python3 slackutil.py -c YOUR_CONFIG_YAML -o write -m "Hello, World!"
```

### Use Case 2 : Delete a message

Just delete a message in a channel.

```
$ python3 slackutil.py -c YOUR_CONFIG_YAML -o delete -t TIMESTAMP
```

TIMESTAMP is UNIXTIME in seconds that you can see in the JSON log of
'history' method.


### Use Case 3 : Save and clean up all the messages in a channel

`worker.sh` is a wrapper script to save and delete all the messages
in a channel.

Create a configuration file (slackutl.yml) and run worker.sh.


